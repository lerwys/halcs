
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>HALCS Installation &#8212; HALCS 1.10.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="HALCS Usage" href="halcs-usage.html" />
    <link rel="prev" title="Welcome to HALCS’s documentation!" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="halcs-installation">
<span id="id1"></span><h1>HALCS Installation<a class="headerlink" href="#halcs-installation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="repositories-and-releases">
<h2>Repositories and Releases<a class="headerlink" href="#repositories-and-releases" title="Permalink to this headline">¶</a></h2>
<p>This project is hosted on Github, at the following link:
<a class="reference external" href="https://github.com/lnls-dig/halcs">HALCS Github Repository</a>.</p>
<p>Here a list of resources that you can find on the project page:</p>
<dl class="docutils">
<dt>Releases <a class="footnote-reference" href="#releases" id="id2">[1]</a></dt>
<dd>Contains the <cite>.rpm</cite> packages for installing HALCS on a CentOS/RedHat/Fedora
and the <cite>.pdf</cite> documentation for every official release.</dd>
<dt>Repository <a class="footnote-reference" href="#repository" id="id3">[2]</a></dt>
<dd>Contains the git repository of the project.</dd>
</dl>
<table class="docutils footnote" frame="void" id="releases" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td><a class="reference external" href="https://github.com/lnls-dig/halcs/releases"><a class="reference external" href="https://github.com/lnls-dig/halcs/releases">https://github.com/lnls-dig/halcs/releases</a></a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="repository" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[2]</a></td><td><a class="reference external" href="https://github.com/lnls-dig/halcs"><a class="reference external" href="https://github.com/lnls-dig/halcs">https://github.com/lnls-dig/halcs</a></a></td></tr>
</tbody>
</table>
<p>On the repository the official releases have a tag named <code class="docutils literal notranslate"><span class="pre">v#maj.#min.#rev</span></code>
where <code class="docutils literal notranslate"><span class="pre">#maj</span></code> represent the major release version of the software, <code class="docutils literal notranslate"><span class="pre">#min</span></code>
the minor one and <code class="docutils literal notranslate"><span class="pre">#rev</span></code> the revision (e.g <code class="docutils literal notranslate"><span class="pre">v1.9.1</span></code>). This follows semantic
versioning as defined in <a class="reference external" href="https://semver.org">Semantic Versioning</a>. The released binary files
follow the same naming convention.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">if you got this from the repository (as opposed to a named <code class="docutils literal notranslate"><span class="pre">tar.gz</span></code>
or <code class="docutils literal notranslate"><span class="pre">pdf</span></code> file) it may happen that you are looking at a later commit
than the release this manual claims to document. It is a fact of life
that developers forget to re-read and fix documentation while updating
the code. In that case, please run <cite>git describe HEAD</cite> to ensure where
you are.</p>
</div>
</div>
<div class="section" id="about-the-source-code">
<h2>About the source code<a class="headerlink" href="#about-the-source-code" title="Permalink to this headline">¶</a></h2>
<div class="section" id="introduction">
<h3>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h3>
<p>The HALCS software makes use of two build systems: <code class="docutils literal notranslate"><span class="pre">make</span></code> <a class="footnote-reference" href="#make" id="id4">[3]</a>
and <code class="docutils literal notranslate"><span class="pre">cmake</span></code> <a class="footnote-reference" href="#cmake" id="id5">[4]</a>. Both of them should produce the same binaries, but
<code class="docutils literal notranslate"><span class="pre">cmake</span></code> gives you more outputs, such as <code class="docutils literal notranslate"><span class="pre">.deb</span></code> and <code class="docutils literal notranslate"><span class="pre">.rpm</span></code> packages. Also,
CMake gives you more controlover how binaries are built and is the recommended
way.</p>
<table class="docutils footnote" frame="void" id="make" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[3]</a></td><td><a class="reference external" href="https://www.gnu.org/software/make"><a class="reference external" href="https://www.gnu.org/software/make">https://www.gnu.org/software/make</a></a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="cmake" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[4]</a></td><td><a class="reference external" href="https://cmake.org"><a class="reference external" href="https://cmake.org">https://cmake.org</a></a></td></tr>
</tbody>
</table>
<p>Prior to build HALCS, we need to install its dependencies. As of the moment,
it makes use of 4 external dependencies:</p>
<dl class="docutils">
<dt>libsodium 1.0.8</dt>
<dd><div class="first last line-block">
<div class="line"><a class="reference external" href="https://github.com/jedisct1/libsodium/tree/1.0.8"><a class="reference external" href="https://github.com/jedisct1/libsodium/tree/">https://github.com/jedisct1/libsodium/tree/</a>1.0.8</a></div>
</div>
</dd>
<dt>zeromq v4.2.5</dt>
<dd><div class="first last line-block">
<div class="line"><a class="reference external" href="https://github.com/zeromq/libzmq/tree/v4.2.5"><a class="reference external" href="https://github.com/zeromq/libzmq/tree/">https://github.com/zeromq/libzmq/tree/</a>v4.2.5</a></div>
</div>
</dd>
<dt>czmq 4.0.2</dt>
<dd><div class="first last line-block">
<div class="line"><a class="reference external" href="https://github.com/zeromq/czmq/tree/v4.0.21.0.8"><a class="reference external" href="https://github.com/zeromq/czmq/tree/">https://github.com/zeromq/czmq/tree/</a>4.0.2</a></div>
</div>
</dd>
<dt>mlm v1.6.1</dt>
<dd><div class="first last line-block">
<div class="line"><a class="reference external" href="https://github.com/lnls-dig/malamute/tree/v1.6.1"><a class="reference external" href="https://github.com/lnls-dig/malamute/tree/">https://github.com/lnls-dig/malamute/tree/</a>v1.6.1</a></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="installing-dependencies">
<h3>Installing dependencies<a class="headerlink" href="#installing-dependencies" title="Permalink to this headline">¶</a></h3>
<p>In order to install them with versions that are known to be compatible use the
following snippet:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68</pre></div></td><td class="code"><div class="highlight"><pre><span></span>git clone --branch<span class="o">=</span><span class="m">1</span>.0.8 https://github.com/jedisct1/libsodium.git <span class="o">&amp;&amp;</span> <span class="se">\</span>
git clone --branch<span class="o">=</span>v4.2.5 https://github.com/zeromq/libzmq.git <span class="o">&amp;&amp;</span> <span class="se">\</span>
git clone --branch<span class="o">=</span>v4.0.2 https://github.com/zeromq/czmq.git <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="k">for</span> project in libsodium libzmq czmq<span class="p">;</span> <span class="k">do</span>
    <span class="nv">CONFIG_OPTS</span><span class="o">=()</span>
    <span class="nv">CONFIG_OPTS</span><span class="o">+=(</span><span class="s2">&quot;CFLAGS=-Wno-format-truncation&quot;</span><span class="o">)</span>
    <span class="nv">CONFIG_OPTS</span><span class="o">+=(</span><span class="s2">&quot;CPPFLAGS=-Wno-format-truncation&quot;</span><span class="o">)</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nv">$project</span> <span class="o">==</span> <span class="s2">&quot;libzmq&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nv">CONFIG_OPTS</span><span class="o">+=(</span><span class="s2">&quot;PKG_CONFIG_PATH=/usr/local/lib/pkgconfig --with-libsodium&quot;</span><span class="o">)</span>
    <span class="k">fi</span>

    <span class="nb">cd</span> <span class="nv">$project</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
    ./autogen.sh <span class="o">&amp;&amp;</span> <span class="se">\</span>
    ./configure <span class="s2">&quot;</span><span class="si">${</span><span class="nv">CONFIG_OPTS</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
    make check <span class="o">&amp;&amp;</span> <span class="se">\</span>
    make <span class="o">&amp;&amp;</span> <span class="se">\</span>
    sudo make install <span class="o">&amp;&amp;</span> <span class="se">\</span>
    sudo ldconfig <span class="o">&amp;&amp;</span> <span class="se">\</span>
    <span class="nb">cd</span> ..

    <span class="c1"># Check last command return status</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -ne <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">&quot;Could not compile/install project </span><span class="nv">$project</span><span class="s2">.&quot;</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
        <span class="nb">exit</span> <span class="m">1</span>
    <span class="k">fi</span>
<span class="k">done</span>

git clone --branch<span class="o">=</span>v1.6.1 https://github.com/lnls-dig/malamute.git <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="k">for</span> project in malamute<span class="p">;</span> <span class="k">do</span>
    <span class="nv">CONFIG_OPTS</span><span class="o">=()</span>
    <span class="nv">CONFIG_OPTS</span><span class="o">+=(</span><span class="s2">&quot;--with-systemd-units&quot;</span><span class="o">)</span>
    <span class="nv">CONFIG_OPTS</span><span class="o">+=(</span><span class="s2">&quot;--sysconfdir=/usr/etc&quot;</span><span class="o">)</span>
    <span class="nv">CONFIG_OPTS</span><span class="o">+=(</span><span class="s2">&quot;--prefix=/usr&quot;</span><span class="o">)</span>
    <span class="nv">CONFIG_OPTS</span><span class="o">+=(</span><span class="s2">&quot;CFLAGS=-Wno-format-truncation&quot;</span><span class="o">)</span>
    <span class="nv">CONFIG_OPTS</span><span class="o">+=(</span><span class="s2">&quot;CPPFLAGS=-Wno-format-truncation&quot;</span><span class="o">)</span>

    <span class="nb">cd</span> <span class="nv">$project</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
    ./autogen.sh <span class="o">&amp;&amp;</span> <span class="se">\</span>
    ./configure <span class="s2">&quot;</span><span class="si">${</span><span class="nv">CONFIG_OPTS</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
    make check <span class="o">&amp;&amp;</span> <span class="se">\</span>
    make <span class="o">&amp;&amp;</span> <span class="se">\</span>
    sudo make install <span class="o">&amp;&amp;</span> <span class="se">\</span>
    sudo ldconfig <span class="o">&amp;&amp;</span> <span class="se">\</span>
    <span class="nb">cd</span> ..

    <span class="nv">MALAMUTE_VERBOSE</span><span class="o">=</span><span class="m">0</span>
    <span class="nv">MALAMUTE_PLAIN_AUTH</span><span class="o">=</span>
    <span class="nv">MALAMUTE_AUTH_MECHANISM</span><span class="o">=</span>null
    <span class="nv">MALAMUTE_ENDPOINT</span><span class="o">=</span><span class="s1">&#39;ipc:///tmp/malamute&#39;</span>
    <span class="nv">MALAMUTE_CFG_FILE</span><span class="o">=</span>/usr/etc/malamute/malamute.cfg
    <span class="c1"># Install our custom Malamute config file</span>
    sudo sed -i <span class="se">\</span>
        -e <span class="s2">&quot;s|verbose\( *\)=.*|verbose\1= </span><span class="si">${</span><span class="nv">MALAMUTE_VERBOSE</span><span class="si">}</span><span class="s2">|g&quot;</span> <span class="se">\</span>
        -e <span class="s2">&quot;s|plain\( *\)=.*|plain\1= </span><span class="si">${</span><span class="nv">MALAMUTE_PLAIN_AUTH</span><span class="si">}</span><span class="s2">|g&quot;</span> <span class="se">\</span>
        -e <span class="s2">&quot;s|mechanism\( *\)=.*|mechanism\1= </span><span class="si">${</span><span class="nv">MALAMUTE_AUTH_MECHANISM</span><span class="si">}</span><span class="s2">|g&quot;</span> <span class="se">\</span>
        -e <span class="s2">&quot;s|tcp://\*:9999|</span><span class="si">${</span><span class="nv">MALAMUTE_ENDPOINT</span><span class="si">}</span><span class="s2">|g&quot;</span> <span class="se">\</span>
        <span class="si">${</span><span class="nv">MALAMUTE_CFG_FILE</span><span class="si">}</span>


    <span class="c1"># Enable service</span>
    sudo systemctl <span class="nb">enable</span> malamute <span class="o">||</span> /bin/true

    <span class="c1"># Check last command return status</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -ne <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">&quot;Could not compile/install project </span><span class="nv">$project</span><span class="s2">.&quot;</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
        <span class="nb">exit</span> <span class="m">1</span>
    <span class="k">fi</span>
<span class="k">done</span>
</pre></div>
</td></tr></table></div>
<p>Alternatively you can install them via <code class="docutils literal notranslate"><span class="pre">.rpm</span></code> or <code class="docutils literal notranslate"><span class="pre">.deb</span></code> packages if available
at your distribution. As all of them use semantic versioning, you can install any
version that is greater or equal than the specified ones for <em>minor</em> and <em>revision</em>:
numbers.</p>
</div>
<div class="section" id="installing-halcs-server">
<h3>Installing HALCS server<a class="headerlink" href="#installing-halcs-server" title="Permalink to this headline">¶</a></h3>
<div class="section" id="using-cmake-build-system">
<h4>Using CMake Build System<a class="headerlink" href="#using-cmake-build-system" title="Permalink to this headline">¶</a></h4>
<p>The recommended way to build the source code is to use <code class="docutils literal notranslate"><span class="pre">cmake</span></code>:</p>
<ol class="arabic simple">
<li>Install <code class="docutils literal notranslate"><span class="pre">make</span></code> and <code class="docutils literal notranslate"><span class="pre">gcc</span></code>:</li>
</ol>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>sudo apt-get install make gcc
</pre></div>
</td></tr></table></div>
<p>for Debian-based systems.</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>sudo yum install make gcc-c++
</pre></div>
</td></tr></table></div>
<p>for Fedora-based systems.</p>
<ol class="arabic simple" start="2">
<li>Install <code class="docutils literal notranslate"><span class="pre">CMake</span></code>. The supported version is <code class="docutils literal notranslate"><span class="pre">3.10+</span></code>. Check you distribution
for the correct <code class="docutils literal notranslate"><span class="pre">CMake</span></code> version:</li>
</ol>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>sudo apt-get install cmake
</pre></div>
</td></tr></table></div>
<p>for Debian-based systems.</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>sudo yum install cmake
</pre></div>
</td></tr></table></div>
<p>for Fedora-based systems.</p>
<ol class="arabic simple" start="3">
<li>Check CMake version with:</li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake --version
</pre></div>
</div>
<p>If the reported version is less than <code class="docutils literal notranslate"><span class="pre">3.10</span></code> install it manually with:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">version</span><span class="o">=</span><span class="m">3</span>.10
<span class="nv">build</span><span class="o">=</span><span class="m">3</span>
wget -c https://cmake.org/files/v<span class="nv">$version</span>/cmake-<span class="nv">$version</span>.<span class="nv">$build</span>.tar.gz -O - <span class="p">|</span> <span class="se">\</span>
    tar -xzv
<span class="nb">cd</span> cmake-<span class="nv">$version</span>.<span class="nv">$build</span>/
</pre></div>
</td></tr></table></div>
<p>Compile and install <code class="docutils literal notranslate"><span class="pre">CMake</span></code>:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./bootstrap
make -j<span class="k">$(</span>nproc<span class="k">)</span>
sudo make install
</pre></div>
</td></tr></table></div>
<ol class="arabic simple" start="4">
<li>Get the source code:</li>
</ol>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>git clone --recursive https://github.com/lnls-dig/halcs
</pre></div>
</td></tr></table></div>
<ol class="arabic simple" start="5">
<li>Go to the source code directory:</li>
</ol>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">cd</span> halcs
</pre></div>
</td></tr></table></div>
<ol class="arabic simple" start="6">
<li>Build and install the code:</li>
</ol>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span>mkdir -p build
<span class="nb">cd</span> build
cmake ../
make
sudo make install
</pre></div>
</td></tr></table></div>
<p>All in all, the full script to install HALCS with <code class="docutils literal notranslate"><span class="pre">cmake</span></code> is:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span>git clone --recursive https://github.com/lnls-dig/halcs <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">cd</span> halcs <span class="o">&amp;&amp;</span> <span class="se">\</span>
mkdir -p build
<span class="nb">cd</span> build
cmake ../
make
sudo make install
</pre></div>
</td></tr></table></div>
<p>Optionally you can build HALCS by creating a <code class="docutils literal notranslate"><span class="pre">.deb</span></code> or <code class="docutils literal notranslate"><span class="pre">.rpm</span></code> and
install them. You can do that by following the instructions:</p>
<p>For Debian-based distributions:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>git clone --recursive https://github.com/lnls-dig/halcs <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">cd</span> halcs <span class="o">&amp;&amp;</span> <span class="se">\</span>
mkdir -p build
<span class="nb">cd</span> build
cmake ../
cpack -G <span class="s2">&quot;DEB&quot;</span>
</pre></div>
</td></tr></table></div>
<p>For Redhat-based distributions:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>git clone --recursive https://github.com/lnls-dig/halcs <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">cd</span> halcs <span class="o">&amp;&amp;</span> <span class="se">\</span>
mkdir -p build
<span class="nb">cd</span> build
cmake ../
cpack -G <span class="s2">&quot;RPM&quot;</span>
</pre></div>
</td></tr></table></div>
<p>Then, just proceed normally with installing the packages on your system.</p>
</div>
<div class="section" id="using-make-build-system">
<h4>Using Make Build System<a class="headerlink" href="#using-make-build-system" title="Permalink to this headline">¶</a></h4>
<p>Here is the procedure to build the binary images from the source using <code class="docutils literal notranslate"><span class="pre">make</span></code>:</p>
<ol class="arabic simple">
<li>Install <code class="docutils literal notranslate"><span class="pre">make</span></code> and <code class="docutils literal notranslate"><span class="pre">gcc</span></code>:</li>
</ol>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>sudo apt-get install make gcc
</pre></div>
</td></tr></table></div>
<p>for Debian-based systems.</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>sudo yum install make gcc-c++
</pre></div>
</td></tr></table></div>
<p>for Fedora-based systems.</p>
<ol class="arabic simple" start="2">
<li>Get the source code:</li>
</ol>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>git clone --recursive https://github.com/lnls-dig/halcs
</pre></div>
</td></tr></table></div>
<ol class="arabic simple" start="3">
<li>Go to the source code directory:</li>
</ol>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">cd</span> halcs
</pre></div>
</td></tr></table></div>
<ol class="arabic simple" start="4">
<li>Build and install the code:</li>
</ol>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>make <span class="o">&amp;&amp;</span> sudo make install
</pre></div>
</td></tr></table></div>
<p>All in all, the full script to install HALCS with <code class="docutils literal notranslate"><span class="pre">make</span></code> is:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>git clone --recursive https://github.com/lnls-dig/halcs <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">cd</span> halcs <span class="o">&amp;&amp;</span> <span class="se">\</span>
make <span class="o">&amp;&amp;</span> <span class="se">\</span>
sudo make install
</pre></div>
</td></tr></table></div>
<p>Alternatively you can use a script called <code class="docutils literal notranslate"><span class="pre">./compile.sh</span></code> that gives you
more flexibility in terms of compilation-time configurability. You should only
use this method if the defaults are not sufficient for you use case:</p>
<ol class="arabic simple">
<li>Install <code class="docutils literal notranslate"><span class="pre">make</span></code> and <code class="docutils literal notranslate"><span class="pre">gcc</span></code>:</li>
</ol>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>sudo apt-get install make gcc
</pre></div>
</td></tr></table></div>
<p>for Debian-based systems.</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>sudo yum install make gcc-c++
</pre></div>
</td></tr></table></div>
<p>for Fedora-based systems.</p>
<ol class="arabic simple" start="2">
<li>Get the source code:</li>
</ol>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>git clone --recursive https://github.com/lnls-dig/halcs
</pre></div>
</td></tr></table></div>
<ol class="arabic simple" start="3">
<li>Go to the source code directory:</li>
</ol>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">cd</span> halcs
</pre></div>
</td></tr></table></div>
<ol class="arabic simple" start="4">
<li>Build and install the code:</li>
</ol>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>./compile.sh -b afcv3_1 -a halcsd -e yes -l yes -d yes
</pre></div>
</td></tr></table></div>
<p>The full procedure would be:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>git clone --recursive https://github.com/lnls-dig/halcs <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">cd</span> halcs <span class="o">&amp;&amp;</span> <span class="se">\</span>
./compile.sh -b afcv3_1 -a halcsd -e yes -l yes -d yes
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="installing-halcs-client">
<h3>Installing HALCS client<a class="headerlink" href="#installing-halcs-client" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id6">
<h4>Using CMake Build System<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>The recommended way to build the client libraries is to use <code class="docutils literal notranslate"><span class="pre">cmake</span></code>:</p>
<p>Build and install libraries:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">TOP</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>
<span class="k">for</span> lib in <span class="se">\</span>
    errhand <span class="se">\</span>
    convc <span class="se">\</span>
    hutils <span class="se">\</span>
    disptable <span class="se">\</span>
    llio <span class="se">\</span>
    halcsclient <span class="se">\</span>
    acqclient <span class="se">\</span>
    bpmclient <span class="se">\</span>
    sdbfs <span class="se">\</span>
    sdbutils<span class="p">;</span> <span class="k">do</span>

    <span class="o">(</span>
        <span class="nb">cd</span> <span class="si">${</span><span class="nv">TOP</span><span class="si">}</span>/libs/<span class="si">${</span><span class="nv">lib</span><span class="si">}</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
        mkdir -p build <span class="o">&amp;&amp;</span> <span class="se">\</span>
        <span class="nb">cd</span> build <span class="o">&amp;&amp;</span> <span class="se">\</span>
        cmake ../ <span class="o">&amp;&amp;</span> <span class="se">\</span>
        make <span class="o">&amp;&amp;</span> <span class="se">\</span>
        sudo make install
    <span class="o">)</span>
<span class="k">done</span>
</pre></div>
</td></tr></table></div>
<p>If you need to uninstall the libraries you can do with:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">TOP</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>
<span class="k">for</span> lib in <span class="se">\</span>
    sdbutils <span class="se">\</span>
    sdbfs <span class="se">\</span>
    bpmclient <span class="se">\</span>
    acqclient <span class="se">\</span>
    halcsclient <span class="se">\</span>
    llio <span class="se">\</span>
    disptable <span class="se">\</span>
    hutils <span class="se">\</span>
    convc <span class="se">\</span>
    errhand<span class="p">;</span> <span class="k">do</span>

    <span class="o">(</span>
        <span class="nb">cd</span> <span class="si">${</span><span class="nv">TOP</span><span class="si">}</span>/libs/<span class="si">${</span><span class="nv">lib</span><span class="si">}</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
        mkdir -p build <span class="o">&amp;&amp;</span> <span class="se">\</span>
        <span class="nb">cd</span> build <span class="o">&amp;&amp;</span> <span class="se">\</span>
        cmake ../ <span class="o">&amp;&amp;</span> <span class="se">\</span>
        sudo make uninstall
    <span class="o">)</span>
<span class="k">done</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id7">
<h4>Using Make Build System<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<p>Another way to build the client libraries is to use <code class="docutils literal notranslate"><span class="pre">make</span></code>:</p>
<p>Build and install inner dependencies:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>make deps
sudo make deps_install
</pre></div>
</td></tr></table></div>
<p>And, then the client libraries themselves:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>make libs
sudo make libs_install
</pre></div>
</td></tr></table></div>
<p>If you need to uninstall the libraries do:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>sudo make libs_uninstall
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="installing-halcs-examples">
<h3>Installing HALCS examples<a class="headerlink" href="#installing-halcs-examples" title="Permalink to this headline">¶</a></h3>
<p>Change to the examples folder:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">cd</span> examples
</pre></div>
</td></tr></table></div>
<div class="section" id="id8">
<h4>Using CMake Build System<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>The recommended way to build the examples is to use <code class="docutils literal notranslate"><span class="pre">cmake</span></code>:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>mkdir -p build
<span class="nb">cd</span> build
cmake ../
make
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id9">
<h4>Using Make Build System<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<p>Another way to build the examples is to use <code class="docutils literal notranslate"><span class="pre">make</span></code>:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>make
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="udev-scripts">
<h3>UDEV scripts<a class="headerlink" href="#udev-scripts" title="Permalink to this headline">¶</a></h3>
<p>HALCS includes three udev scripts, two generic one that sets the device permissions
to the appropriate ones (called <code class="docutils literal notranslate"><span class="pre">60-udev-fpga-rules</span></code> and <code class="docutils literal notranslate"><span class="pre">80-udev-fpga-rules</span></code>)
and another customized udev script, in which you can automatically start a userspace
application if a certain condition is detected (called <code class="docutils literal notranslate"><span class="pre">81-udev-fpga-rules</span></code>). If this,
an application will automatically start a given program when some ID is detected.</p>
<p>Typically the ID used is the <em>Gateware Name</em> represented by the SDB <a class="footnote-reference" href="#sdb" id="id10">[5]</a> property
<code class="docutils literal notranslate"><span class="pre">synthesis-name</span></code> that is baked inside the FPGA Gateware.</p>
<table class="docutils footnote" frame="void" id="sdb" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id10">[5]</a></td><td><a class="reference external" href="https://ohwr.org/project/fpga-config-space/wikis/home"><a class="reference external" href="https://ohwr.org/project/fpga-config-space/wikis/home">https://ohwr.org/project/fpga-config-space/wikis/home</a></a></td></tr>
</tbody>
</table>
<p>To add your specific program to start when some ID is found, the <code class="docutils literal notranslate"><span class="pre">run-fpga-program.sh</span></code>
(typically installed in <code class="docutils literal notranslate"><span class="pre">/usr/local/share/halcs</span></code> or <code class="docutils literal notranslate"><span class="pre">/usr/share/halcs</span></code>) script
can be modified. Below, an excerpt of the script is shown with a possible
modification to allow starting another program:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></div></td><td class="code"><div class="highlight"><pre><span></span>...

<span class="k">for</span> i in <span class="k">$(</span>seq <span class="m">1</span> <span class="s2">&quot;</span><span class="si">${#</span><span class="nv">HALCS_IDXS</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span><span class="p">;</span> <span class="k">do</span>
    <span class="nv">prog_inst</span><span class="o">=</span><span class="k">$((</span>i-1<span class="k">))</span><span class="p">;</span>
    <span class="k">case</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">GATEWARE_NAME</span><span class="si">}</span><span class="s2">&quot;</span> in
        bpm-gw*<span class="o">)</span>
            <span class="k">case</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">FMC_NAMES</span><span class="p">[</span><span class="nv">$prog_inst</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> in
                LNLS_FMC250M*<span class="o">)</span>
                    <span class="nv">START_PROGRAM</span><span class="o">=</span><span class="s2">&quot;/usr/bin/systemctl --no-block start halcs-ioc@</span><span class="si">${</span><span class="nv">HALCS_IDXS</span><span class="p">[</span><span class="nv">$prog_inst</span><span class="p">]</span><span class="si">}</span><span class="s2">.target&quot;</span>
                    <span class="p">;;</span>
                LNLS_FMC130M*<span class="o">)</span>
                    <span class="nv">START_PROGRAM</span><span class="o">=</span><span class="s2">&quot;/usr/bin/systemctl --no-block start halcs-ioc@</span><span class="si">${</span><span class="nv">HALCS_IDXS</span><span class="p">[</span><span class="nv">$prog_inst</span><span class="p">]</span><span class="si">}</span><span class="s2">.target&quot;</span>
                    <span class="p">;;</span>
                *<span class="o">)</span>
                    <span class="nb">echo</span> <span class="s2">&quot;Unsupported Gateware Module: &quot;</span><span class="si">${</span><span class="nv">FPGA_FMC_NAME</span><span class="si">}</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
                    <span class="nb">exit</span> <span class="m">1</span>
                    <span class="p">;;</span>
            <span class="k">esac</span>
            <span class="p">;;</span>

        tim-receiver*<span class="o">)</span>
            <span class="nv">START_PROGRAM</span><span class="o">=</span><span class="s2">&quot;/usr/bin/systemctl --no-block start halcs-ioc@</span><span class="si">${</span><span class="nv">HALCS_IDXS</span><span class="p">[</span><span class="nv">$prog_inst</span><span class="p">]</span><span class="si">}</span><span class="s2">.target&quot;</span>
            <span class="p">;;</span>

        afc-tim*<span class="o">)</span>
            <span class="c1"># Only start IOCs for even-numbered instances, as there is no device for odd-numbered instances</span>
            <span class="k">if</span> <span class="o">[</span> <span class="k">$((</span>prog_inst%2<span class="k">))</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
                <span class="nv">START_PROGRAM</span><span class="o">=</span><span class="s2">&quot;/usr/bin/systemctl --no-block start tim-rx-ioc@</span><span class="si">${</span><span class="nv">HALCS_IDXS</span><span class="p">[</span><span class="nv">$prog_inst</span><span class="p">]</span><span class="si">}</span><span class="s2">.service&quot;</span>
            <span class="k">else</span>
                <span class="nv">START_PROGRAM</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
            <span class="k">fi</span>
            <span class="p">;;</span>

        pbpm-gw*<span class="o">)</span>
            <span class="nv">START_PROGRAM</span><span class="o">=</span><span class="s2">&quot;/usr/bin/systemctl --no-block start halcs-ioc@</span><span class="si">${</span><span class="nv">HALCS_IDXS</span><span class="p">[</span><span class="nv">$prog_inst</span><span class="p">]</span><span class="si">}</span><span class="s2">.target&quot;</span>
            <span class="p">;;</span>

<span class="hll">        &lt;ADD YOU GATEWARE NAME HERE&gt;*<span class="o">)</span>
</span><span class="hll">            <span class="nv">START_PROGRAM</span><span class="o">=</span><span class="s2">&quot;&lt;ADD YOUR START PROGRAM HERE&gt;&quot;</span>
</span><span class="hll">            <span class="p">;;</span>
</span>
        *<span class="o">)</span>
            <span class="nb">echo</span> <span class="s2">&quot;Invalid Gateware: &quot;</span><span class="si">${</span><span class="nv">GATEWARE_NAME</span><span class="si">}</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
            <span class="nb">exit</span> <span class="m">2</span>
            <span class="p">;;</span>
    <span class="k">esac</span>

    <span class="nb">eval</span> <span class="si">${</span><span class="nv">START_PROGRAM</span><span class="si">}</span>
<span class="k">done</span>

...
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="updating-dependencies">
<h3>Updating Dependencies<a class="headerlink" href="#updating-dependencies" title="Permalink to this headline">¶</a></h3>
<p>If you already have dependencies installed and wish to remote update to a
specific release you can run the following snippet. Be advised that you
would need to change the repository locations to match your environment:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">NODES</span><span class="o">=()</span>
<span class="nv">NODES</span><span class="o">+=(</span><span class="s2">&quot;&lt;type the computer IP that you wish to update&gt;&quot;</span><span class="o">)</span>

<span class="k">for</span> crate in <span class="s2">&quot;</span><span class="si">${</span><span class="nv">NODES</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">do</span>
    <span class="nv">SSHPASS</span><span class="o">=</span>root sshpass -e ssh -o <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no <span class="se">\</span>
    root@<span class="si">${</span><span class="nv">crate</span><span class="si">}</span> bash -s <span class="s">&lt;&lt;&#39;EOF&#39;</span>
<span class="s">        set -x &amp;&amp; \</span>
<span class="s">        export PKG_CONFIG_PATH=/usr/local/lib/pkgconfig &amp;&amp; \</span>
<span class="s">        DEP_DIR=/root/postinstall/apps/bpm-app &amp;&amp; \</span>
<span class="s">        libsodium_VER=1.0.8 &amp;&amp; \</span>
<span class="s">        libzmq_VER=v4.2.5 &amp;&amp; \</span>
<span class="s">        libczmq_VER=v4.0.2 &amp;&amp; \</span>
<span class="s">        malamute_VER=v1.6.1 &amp;&amp; \</span>
<span class="s">        cd ${DEP_DIR} &amp;&amp; \</span>
<span class="s">        for project in libsodium libzmq czmq; do</span>
<span class="s">            PROJECT_VER=${project}_VER</span>
<span class="s">            CONFIG_OPTS=()</span>
<span class="s">            CONFIG_OPTS+=(&quot;CFLAGS=-Wno-format-truncation&quot;)</span>
<span class="s">            CONFIG_OPTS+=(&quot;CPPFLAGS=-Wno-format-truncation&quot;)</span>
<span class="s">            if [ $project == &quot;libzmq&quot; ]; then</span>
<span class="s">                CONFIG_OPTS+=(&quot;--with-libsodium&quot;)</span>
<span class="s">            fi</span>

<span class="s">            cd $project &amp;&amp; \</span>
<span class="s">            git fetch --all &amp;&amp; \</span>
<span class="s">            git stash &amp;&amp; \</span>
<span class="s">            git checkout -f ${!PROJECT_VER} &amp;&amp; \</span>
<span class="s">            git reset --hard ${!PROJECT_VER} &amp;&amp; \</span>
<span class="s">            ./autogen.sh &amp;&amp; \</span>
<span class="s">            ./configure &quot;${CONFIG_OPTS[@]}&quot; &amp;&amp; \</span>
<span class="s">            make check &amp;&amp; \</span>
<span class="s">            make &amp;&amp; \</span>
<span class="s">            sudo make install &amp;&amp; \</span>
<span class="s">            sudo ldconfig &amp;&amp; \</span>
<span class="s">            cd ..</span>

<span class="s">            # Check last command return status</span>
<span class="s">            if [ $? -ne 0 ]; then</span>
<span class="s">                echo &quot;Could not compile/install project $project.&quot; &gt;&amp;2</span>
<span class="s">                exit 1</span>
<span class="s">            fi</span>
<span class="s">        done</span>

<span class="s">        cd ${DEP_DIR} &amp;&amp; \</span>
<span class="s">        for project in malamute; do</span>
<span class="s">            PROJECT_VER=${project}_VER</span>
<span class="s">            CONFIG_OPTS=()</span>
<span class="s">            CONFIG_OPTS+=(&quot;--with-systemd-units&quot;)</span>
<span class="s">            CONFIG_OPTS+=(&quot;--sysconfdir=/usr/etc&quot;)</span>
<span class="s">            CONFIG_OPTS+=(&quot;--prefix=/usr&quot;)</span>
<span class="s">            CONFIG_OPTS+=(&quot;CFLAGS=-Wno-format-truncation&quot;)</span>
<span class="s">            CONFIG_OPTS+=(&quot;CPPFLAGS=-Wno-format-truncation&quot;)</span>

<span class="s">            cd $project &amp;&amp; \</span>
<span class="s">            git fetch --all &amp;&amp; \</span>
<span class="s">            git stash &amp;&amp; \</span>
<span class="s">            git checkout -f ${!PROJECT_VER} &amp;&amp; \</span>
<span class="s">            git reset --hard ${!PROJECT_VER} &amp;&amp; \</span>
<span class="s">            ./autogen.sh &amp;&amp; \</span>
<span class="s">            ./configure &quot;${CONFIG_OPTS[@]}&quot; &amp;&amp; \</span>
<span class="s">            make check &amp;&amp; \</span>
<span class="s">            make &amp;&amp; \</span>
<span class="s">            sudo make install &amp;&amp; \</span>
<span class="s">            sudo ldconfig &amp;&amp; \</span>
<span class="s">            cd ..</span>

<span class="s">            MALAMUTE_VERBOSE=0</span>
<span class="s">            MALAMUTE_PLAIN_AUTH=</span>
<span class="s">            MALAMUTE_AUTH_MECHANISM=null</span>
<span class="s">            MALAMUTE_ENDPOINT=&#39;ipc:///tmp/malamute&#39;</span>
<span class="s">            MALAMUTE_CFG_FILE=/usr/etc/malamute/malamute.cfg</span>
<span class="s">            # Install our custom Malamute config file</span>
<span class="s">            sudo sed -i \</span>
<span class="s">                -e &quot;s|verbose\( *\)=.*|verbose\1= ${MALAMUTE_VERBOSE}|g&quot; \</span>
<span class="s">                -e &quot;s|plain\( *\)=.*|plain\1= ${MALAMUTE_PLAIN_AUTH}|g&quot; \</span>
<span class="s">                -e &quot;s|mechanism\( *\)=.*|mechanism\1= ${MALAMUTE_AUTH_MECHANISM}|g&quot; \</span>
<span class="s">                -e &quot;s|tcp://\*:9999|${MALAMUTE_ENDPOINT}|g&quot; \</span>
<span class="s">                ${MALAMUTE_CFG_FILE}</span>

<span class="s">            # Enable service</span>
<span class="s">            sudo systemctl enable malamute || /bin/true</span>
<span class="s">            sudo systemctl restart malamute || /bin/true</span>

<span class="s">            # Check last command return status</span>
<span class="s">            if [ $? -ne 0 ]; then</span>
<span class="s">                echo &quot;Could not compile/install project $project.&quot; &gt;&amp;2</span>
<span class="s">                exit 1</span>
<span class="s">            fi</span>
<span class="s">        done</span>
<span class="s">EOF</span>
<span class="k">done</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="updating-halcs">
<h3>Updating HALCS<a class="headerlink" href="#updating-halcs" title="Permalink to this headline">¶</a></h3>
<p>If you already have the software installed and wish to remote update to the
latest release you can run the following snippet. Be advised that this is just
an example and assumes specific paths and running applications:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">NODES</span><span class="o">=()</span>
<span class="nv">NODES</span><span class="o">+=(</span><span class="s2">&quot;&lt;type the computer IP that you wish to update&gt;&quot;</span><span class="o">)</span>

<span class="k">for</span> crate in <span class="s2">&quot;</span><span class="si">${</span><span class="nv">NODES</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">do</span>
    <span class="nv">SSHPASS</span><span class="o">=</span>root sshpass -e ssh -o <span class="nv">StrictHostKeyChecking</span><span class="o">=</span>no <span class="se">\</span>
    root@<span class="si">${</span><span class="nv">crate</span><span class="si">}</span> bash -s <span class="s">&lt;&lt;&#39;EOF&#39;</span>
<span class="s">        set -x &amp;&amp; \</span>
<span class="s">        DEP_DIR=/root/postinstall/apps/bpm-app &amp;&amp; \</span>
<span class="s">        PROJECT_VER=master &amp;&amp; \</span>
<span class="s">        cd ${DEP_DIR}/halcs &amp;&amp; \</span>
<span class="s">        git fetch --all &amp;&amp; \</span>
<span class="s">        git checkout -b stable-$(date +%Y%m%d-%H%M%S) &amp;&amp; \</span>
<span class="s">        git checkout ${!PROJECT_VER} &amp;&amp; \</span>
<span class="s">        git reset --hard ${!PROJECT_VER} &amp;&amp; \</span>
<span class="s">        cp /usr/local/etc/halcs/halcs.cfg /home/lnls-bpm/halcs.cfg.temp &amp;&amp; \</span>
<span class="s">        systemctl stop \</span>
<span class="s">            halcs@{7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24}.target &amp;&amp; \</span>
<span class="s">        cd ${DEP_DIR}/halcs &amp;&amp; \</span>
<span class="s">        mkdir -p build &amp;&amp; \</span>
<span class="s">        cd build &amp;&amp; \</span>
<span class="s">        cmake ../ &amp;&amp; \</span>
<span class="s">        make &amp;&amp; \</span>
<span class="s">        sudo make install &amp;&amp; \</span>
<span class="s">        mv /home/lnls-bpm/halcs.cfg.temp /usr/local/etc/halcs/halcs.cfg &amp;&amp; \</span>
<span class="s">        systemctl daemon-reload &amp;&amp; \</span>
<span class="s">        systemctl start \</span>
<span class="s">            halcs-ioc@{7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24}.target</span>
<span class="s">EOF</span>
<span class="k">done</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="source-code-organization">
<h3>Source Code Organization<a class="headerlink" href="#source-code-organization" title="Permalink to this headline">¶</a></h3>
<p>To be written</p>
</div>
<div class="section" id="dependencies">
<h3>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h3>
<p>HALCS depends on the following libraries:</p>
<dl class="docutils">
<dt>libsodium</dt>
<dd><div class="first last line-block">
<div class="line">Repository: <a class="reference external" href="https://github.com/jedisct1/libsodium/tree/1.0.8"><a class="reference external" href="https://github.com/jedisct1/libsodium/tree/">https://github.com/jedisct1/libsodium/tree/</a>1.0.8</a></div>
<div class="line">Version: 1.0.8</div>
</div>
</dd>
<dt>zeromq</dt>
<dd><div class="first last line-block">
<div class="line">Repository: <a class="reference external" href="https://github.com/zeromq/libzmq/tree/v4.2.5"><a class="reference external" href="https://github.com/zeromq/libzmq/tree/">https://github.com/zeromq/libzmq/tree/</a>v4.2.5</a></div>
<div class="line">Version: v4.2.5</div>
</div>
</dd>
<dt>czmq</dt>
<dd><div class="first last line-block">
<div class="line">Repository: <a class="reference external" href="https://github.com/zeromq/czmq/tree/v4.0.21.0.8"><a class="reference external" href="https://github.com/zeromq/czmq/tree/">https://github.com/zeromq/czmq/tree/</a>4.0.2</a></div>
<div class="line">Version: 4.0.2</div>
</div>
</dd>
<dt>mlm</dt>
<dd><div class="first last line-block">
<div class="line">Repository: <a class="reference external" href="https://github.com/lnls-dig/malamute/tree/v1.6.1"><a class="reference external" href="https://github.com/lnls-dig/malamute/tree/">https://github.com/lnls-dig/malamute/tree/</a>v1.6.1</a></div>
<div class="line">Version: v1.6.1</div>
</div>
</dd>
</dl>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">HALCS</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">HALCS Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#repositories-and-releases">Repositories and Releases</a></li>
<li class="toctree-l2"><a class="reference internal" href="#about-the-source-code">About the source code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-dependencies">Installing dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-halcs-server">Installing HALCS server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-cmake-build-system">Using CMake Build System</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-make-build-system">Using Make Build System</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#installing-halcs-client">Installing HALCS client</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id6">Using CMake Build System</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">Using Make Build System</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#installing-halcs-examples">Installing HALCS examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id8">Using CMake Build System</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">Using Make Build System</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#udev-scripts">UDEV scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#updating-dependencies">Updating Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#updating-halcs">Updating HALCS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#source-code-organization">Source Code Organization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dependencies">Dependencies</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="halcs-usage.html">HALCS Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="halcs-architecture.html">HALCS Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="halcs-development.html">HALCS Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="halcs-tools.html">HALCS Tools</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Welcome to HALCS’s documentation!</a></li>
      <li>Next: <a href="halcs-usage.html" title="next chapter">HALCS Usage</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Lucas Russo.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/halcs-installation.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>